name: Migration Engine Verification

on:
  push:
    branches:
      - main
      - 'feature/**'
  pull_request:
    branches: [ main ]

jobs:
  verify:
    name: Verify Migration Logic
    runs-on: ubuntu-latest

    strategy:
      fail-fast: false
      matrix:
        # FIX: ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡¶æ‡¶∞‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ Scala 3.5.0 ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
        scala: [ "2.13.14", "3.5.0" ]
        java: [ "17" ]

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Java JDK
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: ${{ matrix.java }}

      # üî• CRITICAL FIX: ‡¶ó‡¶ø‡¶ü‡¶π‡¶æ‡¶¨‡ßá sbt ‡¶á‡¶®‡ßç‡¶∏‡¶ü‡¶≤ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶á ‡¶∏‡ßç‡¶ü‡ßá‡¶™‡¶ü‡¶ø ‡¶¨‡¶æ‡¶ß‡ßç‡¶Ø‡¶§‡¶æ‡¶Æ‡ßÇ‡¶≤‡¶ï
      # ‡¶è‡¶ü‡¶ø ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá "sbt: command not found" ‡¶è‡¶∞‡¶∞ ‡¶Ü‡¶∏‡¶¨‡ßá‡•§
      - name: Setup sbt
        uses: sbt/setup-sbt@v1

      - name: Compile (schemaJVM Only)
        run: |
          sbt ++${{ matrix.scala }} "project schemaJVM" clean compile

      - name: Run Functional Tests
        run: |
          sbt ++${{ matrix.scala }} "project schemaJVM" test

      - name: Strict Audit (Serialization & Reflection Check)
        run: |
          sbt ++${{ matrix.scala }} "project schemaJVM" "testOnly *.VerificationSpec"