name: Migration Engine Verification

on:
  push:
    branches:
      - main
      - 'feature/**'
  pull_request:
    branches: [ main ]

jobs:
  verify:
    name: Verify Migration Logic
    runs-on: ubuntu-latest

    strategy:
      fail-fast: false
      matrix:
        scala: [ "2.13.12", "3.5.0" ] # Scala 3.5.0 ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
        java: [ "17" ]

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Java JDK
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: ${{ matrix.java }}

      # üî•üî•üî• ‡¶è‡¶á ‡¶Ö‡¶Ç‡¶∂‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡¶æ‡¶á‡¶≤‡ßá ‡¶®‡ßá‡¶á, ‡¶è‡¶ü‡¶ø ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá üî•üî•üî•
      - name: Setup sbt
        uses: sbt/setup-sbt@v1

      - name: Compile (schemaJVM Only)
        run: |
          sbt ++${{ matrix.scala }} "project schemaJVM" clean compile

      - name: Run Functional Tests
        run: |
          sbt ++${{ matrix.scala }} "project schemaJVM" test

      - name: Strict Audit (Serialization & Reflection Check)
        run: |
          sbt ++${{ matrix.scala }} "project schemaJVM" "testOnly *.VerificationSpec"